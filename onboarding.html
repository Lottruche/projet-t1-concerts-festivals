<!DOCTYPE html>
<html lang="fr-FR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Onboarding - Préférences Musicales</title>
    <link rel="stylesheet" href="css/main.css">
</head>

<body>
    <div class="onboarding-container">
        <!-- Step 1: Music Genres -->
        <div class="step active" id="step1">
            <h2>Quels genres de musique préfères-tu ?</h2>

            <div class="search-container">
                <button class="search-icon-only" id="genreSearchToggle" onclick="toggleGenreSearch()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <input type="text" class="search-input" id="genreSearch" placeholder="Rechercher un genre...">
            </div>

            <div class="genre-list" id="genreList">
            </div>
        </div>

        <!-- Step 2: Favorite Artists -->
        <div class="step" id="step2">
            <h2>Quels sont tes artistes préférés ?</h2>

            <div class="search-container">
                <button class="search-icon-only" id="searchToggle" onclick="toggleSearch()">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <circle cx="11" cy="11" r="8" stroke="currentColor" stroke-width="2"/>
                        <path d="M21 21L16.65 16.65" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
                <input type="text" class="search-input" id="artistSearch" placeholder="Rechercher un artiste...">
            </div>

            <div class="artist-list" id="artistList">
            </div>
        </div>

        <!-- Step 3: People Type -->
        <div class="step" id="step3">
            <h2>Quelles personnes cherches-tu ?</h2>

            <div class="section-title">Tranche d'âge</div>
            <div class="people-options" id="ageOptions">
                <div class="people-card" onclick="toggleOption(this, 'age', '18-25')">
                    <div class="people-title">18 - 25 ans</div>
                </div>
                <div class="people-card" onclick="toggleOption(this, 'age', '25-35')">
                    <div class="people-title">25 - 35 ans</div>
                </div>
                <div class="people-card" onclick="toggleOption(this, 'age', '35-45')">
                    <div class="people-title">35 - 45 ans</div>
                </div>
                <div class="people-card" onclick="toggleOption(this, 'age', '45+')">
                    <div class="people-title">45 et +</div>
                </div>
                <div class="people-card" onclick="toggleOption(this, 'age', 'any')">
                    <div class="people-title">Peu importe</div>
                </div>
            </div>

            <div class="section-title">Genre</div>
            <div class="people-options" id="genderOptions">
                <div class="people-card" onclick="toggleOption(this, 'gender', 'women')">
                    <div class="people-title">Femmes</div>
                </div>
                <div class="people-card" onclick="toggleOption(this, 'gender', 'men')">
                    <div class="people-title">Hommes</div>
                </div>
                <div class="people-card" onclick="toggleOption(this, 'gender', 'any')">
                    <div class="people-title">Peu importe</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <div class="nav-buttons">
        <button class="nav-btn" id="prevBtn" onclick="previousStep()">«</button>
        <a href="#" class="skip-link" id="skipLink" onclick="skipStep(); return false;">Passer</a>
        <button class="nav-btn" id="nextBtn" onclick="nextStep()">»</button>
    </div>

    <button class="finish-btn" id="finishBtn" onclick="finishOnboarding()" style="display: none;">C'est parti !</button>

    <div class="progress-dots">
        <div class="progress-dot active" data-step="1"></div>
        <div class="progress-dot" data-step="2"></div>
        <div class="progress-dot" data-step="3"></div>
    </div>

    <script>
        // Data storage
        let currentStep = 1;
        const totalSteps = 3;
        let selectedGenres = [];
        let selectedArtists = [];
        let selectedAge = [];
        let selectedGender = [];

        // Sample data
        const genres = [
            'Rap / Hip-Hop', 'Electro', 'Afro', 'R&B / Soul', 'Métal',
            'Jazz', 'House', 'Chanson Française', 'Rock', 'Pop',
            'Techno', 'Reggae / Dub', 'Latino', 'K-pop', 'Blues', 'Classique'
        ];

        const artists = [
            'The Weeknd', 'Beyoncé', 'Théodora', 'Damso', 'Sabrina Carpenter',
            'Jul', 'Giveon', 'Stray Kids', 'Billie Eilish', 'Taylor Swift',
            'Drake', 'Rosalía', 'SDM', 'Lady Gaga', 'Imagine Dragons',
            'Kendji Girac', 'Kendrick Lamar', 'Stromae', 'Angèle', 'Orelsan'
        ];

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            updateNavigation();
            updateProgressDots();
            initializeGenreList();
            initializeArtistList();
            setupSearchListeners();
        });

        function updateProgressDots() {
            document.querySelectorAll('.progress-dot').forEach((dot, index) => {
                if (index + 1 === currentStep) {
                    dot.classList.add('active');
                } else {
                    dot.classList.remove('active');
                }
            });
        }

        function updateNavigation() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const finishBtn = document.getElementById('finishBtn');
            const skipLink = document.getElementById('skipLink');

            prevBtn.disabled = currentStep === 1;
            
            if (currentStep === 3) {
                nextBtn.style.display = 'none';
                finishBtn.style.display = 'block';
                skipLink.style.display = 'none';
            } else {
                nextBtn.style.display = 'flex';
                finishBtn.style.display = 'none';
                skipLink.style.display = 'block';
            }
        }

        function initializeGenreList() {
            const container = document.getElementById('genreList');
            container.innerHTML = genres.map(genre => 
                `<div class="artist-item" onclick="toggleGenre(this, '${genre}')">${genre}</div>`
            ).join('');
        }

        function initializeArtistList() {
            const container = document.getElementById('artistList');
            container.innerHTML = artists.map(artist => 
                `<div class="artist-item" onclick="toggleArtist(this, '${artist}')">${artist}</div>`
            ).join('');
        }

        function toggleGenre(element, genre) {
            element.classList.toggle('selected');
            
            if (element.classList.contains('selected')) {
                if (!selectedGenres.includes(genre)) {
                    selectedGenres.push(genre);
                }
            } else {
                selectedGenres = selectedGenres.filter(g => g !== genre);
            }
        }

        function toggleArtist(element, artist) {
            element.classList.toggle('selected');
            
            if (element.classList.contains('selected')) {
                if (!selectedArtists.includes(artist)) {
                    selectedArtists.push(artist);
                }
            } else {
                selectedArtists = selectedArtists.filter(a => a !== artist);
            }
        }

        function toggleOption(element, type, value) {
            // Remove 'Peu importe' if another option is selected
            const container = element.parentElement;
            const anyOption = Array.from(container.children).find(child => 
                child.querySelector('.people-title').textContent === 'Peu importe'
            );

            if (element !== anyOption && element.classList.contains('selected') === false) {
                if (anyOption) {
                    anyOption.classList.remove('selected');
                    if (type === 'age') {
                        selectedAge = selectedAge.filter(v => v !== 'any');
                    } else {
                        selectedGender = selectedGender.filter(v => v !== 'any');
                    }
                }
            }

            // If selecting 'Peu importe', deselect all others
            if (element === anyOption) {
                Array.from(container.children).forEach(child => {
                    if (child !== anyOption) {
                        child.classList.remove('selected');
                    }
                });
                if (type === 'age') {
                    selectedAge = ['any'];
                } else {
                    selectedGender = ['any'];
                }
            }

            element.classList.toggle('selected');
            
            if (element.classList.contains('selected')) {
                if (type === 'age' && !selectedAge.includes(value)) {
                    selectedAge.push(value);
                } else if (type === 'gender' && !selectedGender.includes(value)) {
                    selectedGender.push(value);
                }
            } else {
                if (type === 'age') {
                    selectedAge = selectedAge.filter(v => v !== value);
                } else {
                    selectedGender = selectedGender.filter(v => v !== value);
                }
            }
        }

        function toggleGenreSearch() {
            const searchInput = document.getElementById('genreSearch');
            const searchToggle = document.getElementById('genreSearchToggle');
            
            if (searchInput.classList.contains('visible')) {
                searchInput.classList.remove('visible');
                searchToggle.classList.remove('hidden');
            } else {
                searchInput.classList.add('visible');
                searchToggle.classList.add('hidden');
                searchInput.focus();
            }
        }

        function toggleSearch() {
            const searchInput = document.getElementById('artistSearch');
            const searchToggle = document.getElementById('searchToggle');
            
            if (searchInput.classList.contains('visible')) {
                searchInput.classList.remove('visible');
                searchToggle.classList.remove('hidden');
            } else {
                searchInput.classList.add('visible');
                searchToggle.classList.add('hidden');
                searchInput.focus();
            }
        }

        function setupSearchListeners() {
            // Genre search
            const genreSearch = document.getElementById('genreSearch');
            genreSearch.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const genreItems = document.querySelectorAll('#genreList .artist-item');
                
                genreItems.forEach(item => {
                    const genreName = item.textContent.toLowerCase();
                    if (genreName.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            genreSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    const newGenre = e.target.value.trim();
                    const genreList = document.getElementById('genreList');
                    const newItem = document.createElement('div');
                    newItem.className = 'artist-item selected';
                    newItem.textContent = newGenre;
                    newItem.onclick = function() { toggleGenre(this, newGenre); };
                    genreList.insertBefore(newItem, genreList.firstChild);
                    selectedGenres.push(newGenre);
                    e.target.value = '';
                    
                    // Reset filter
                    document.querySelectorAll('#genreList .artist-item').forEach(item => {
                        item.style.display = 'block';
                    });
                }
            });

            // Artist search
            const artistSearch = document.getElementById('artistSearch');
            artistSearch.addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                const artistItems = document.querySelectorAll('.artist-item');
                
                artistItems.forEach(item => {
                    const artistName = item.textContent.toLowerCase();
                    if (artistName.includes(searchTerm)) {
                        item.style.display = 'block';
                    } else {
                        item.style.display = 'none';
                    }
                });
            });

            artistSearch.addEventListener('keypress', function(e) {
                if (e.key === 'Enter' && e.target.value.trim()) {
                    const newArtist = e.target.value.trim();
                    const artistList = document.getElementById('artistList');
                    const newItem = document.createElement('div');
                    newItem.className = 'artist-item selected';
                    newItem.textContent = newArtist;
                    newItem.onclick = function() { toggleArtist(this, newArtist); };
                    artistList.insertBefore(newItem, artistList.firstChild);
                    selectedArtists.push(newArtist);
                    e.target.value = '';
                    
                    // Reset filter
                    document.querySelectorAll('.artist-item').forEach(item => {
                        item.style.display = 'block';
                    });
                }
            });
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep++;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateNavigation();
                updateProgressDots();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                document.getElementById(`step${currentStep}`).classList.remove('active');
                currentStep--;
                document.getElementById(`step${currentStep}`).classList.add('active');
                updateNavigation();
                updateProgressDots();
            }
        }

        function skipStep() {
            nextStep();
        }

        function finishOnboarding() {
            const preferences = {
                genres: selectedGenres,
                artists: selectedArtists,
                age: selectedAge,
                gender: selectedGender
            };
            
            console.log('Préférences utilisateur:', preferences);
            
            // Store preferences
            localStorage.setItem('userPreferences', JSON.stringify(preferences));
            
            // Marquer que l'utilisateur vient de terminer l'onboarding
            localStorage.setItem('fromOnboarding', 'true');
            
            // Redirect to main page
            window.location.href = 'index.html';
        }
    </script>
</body>

</html>
